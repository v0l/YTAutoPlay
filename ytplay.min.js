!function(){this.pagesLoaded=0,this.loadPagesMax=10,this.loadMoreTrigger=3,this.playerWidth=window.innerWidth/2,this.playerHeight=window.innerHeight/2+44,this.VideoQueue=[],this.Init=function(){document.querySelector("ytd-section-list-renderer").addEventListener("yt-next-continuation-data-updated",this.LoadMoreCompleted.bind(this)),this.CollectVids()},this.CollectVids=function(){for(var e=document.querySelectorAll("ytd-grid-video-renderer"),t=0,i=0;i<e.length;i++){var o=e[i].data;if(o.isWatched?t++:(t=0,this.VideoQueue.push(o.videoId)),t>=this.loadMoreTrigger){console.log("No more will be loaded, reached threshold "+this.loadMoreTrigger+" videos watched in a row"),this.StartPlayer();break}}this.pagesLoaded<this.loadPagesMax?t<this.loadMoreTrigger&&this.LoadMore():(this.StartPlayer(),console.log("No more will be loaded, reached threshold loadPagesMax"))},this.LoadMoreCompleted=function(e){setTimeout(function(){this.pagesLoaded++,this.CollectVids()}.bind(this),100)},this.LoadMore=function(){console.log("Loading page: "+this.pagesLoaded),document.querySelector("yt-next-continuation").trigger()},this.StartPlayer=function(){this.CreateOverlay()},this.GetPlayer=function(){return this.player.contentDocument.querySelector("#player").firstChild},this.UpdateStatus=function(){this.Status.innerHTML=this.VideoQueue.length+" videos left"},this.CreateOverlay=function(){var e=document.createElement("div");e.id="sapPlayer",e.style.width=this.playerWidth+"px",e.style.height=this.playerHeight+"px",e.style.top="0px",e.style.marginLeft=window.innerWidth/2-this.playerWidth/2+"px",e.style.marginRight="auto",e.style.marginTop=window.innerHeight/2-this.playerHeight/2+"px",e.style.position="fixed",e.style.border="1px solid #888",e.style.borderRadius="5px",e.style.zIndex="9999999999",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.padding="10px",e.style.color="#fff";var t=document.createElement("div");t.style.backgroundImage="url('https://raw.githubusercontent.com/google/material-design-icons/master/navigation/1x_web/ic_chevron_right_white_24dp.png')",t.style.width="24px",t.style.height="24px",t.style.float="left",t.onclick=function(){this.GetPlayer().loadVideoById(this.VideoQueue.pop()),this.UpdateStatus()}.bind(this),e.appendChild(t),this.Status=document.createElement("div"),this.Status.style.float="left",this.Status.style.lineHeight="24px",e.appendChild(this.Status),this.player=document.createElement("iframe"),this.player.style.width=this.playerWidth+"px",this.player.style.height=this.playerHeight-34+"px",this.player.style.border="none",this.player.src="https://www.youtube.com/embed/"+this.VideoQueue.pop()+"?autoplay=1&enablejsapi=1",e.appendChild(this.player),this.UpdateStatus(),document.querySelector("body").appendChild(e)},this.Init()}();